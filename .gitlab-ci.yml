stages:
 - build
 - run
 - cutflow
 - plot

image: rootproject/root-conda

build_skim:
  stage: build
  script:
    - pwd
    - echo ">>> Compile skimming executable ..." &&  \
    - COMPILER=$(root-config --cxx) &&  \
    - FLAGS=$(root-config --cflags --libs) &&  \
    - time $COMPILER -g -std=c++11 -O3 -Wall -Wextra -Wpedantic -o skim skim.cxx $FLAGS
  artifacts:
    paths:
    - skim
    expire_in: 1 week
    
skim_higgs:
  stage: run
  dependencies: 
    - build_skim
  script:
    - pwd
    - ls
    - echo $SERVICE_PASS | kinit $CERN_USER@CERN.CH
    - xrdcp root://eosuser.cern.ch//eos/user/m/meehan/APBootCampFeb20/GluGluToHToTauTau.root GluGluToHToTauTau.root
    - ./skim GluGluToHToTauTau.root GluGluToHToTauTau_skimmed.root 19.6 11467.0 0.1 > log_higgs.txt
  artifacts:
    paths:
    - log_higgs.txt
    expire_in: 1 week
    
cutflow_higgs:
  stage: cutflow
  dependencies:
    - skim_higgs
  script:
    - pwd
    - ls
    - python test_cutflow.py log_higgs.txt cutflow_GluGluToHToTauTau.txt
    
    
plot_higgs:
  stage: plot
  dependencies:
    - skim_higgs
  allow_failure: true
  script:
    - pwd
    - ls
    - python histograms.py GluGluToHToTauTau_skimmed.root ggH GluGluToHToTauTau_histograms.root
    - mkdir plot_higgs_output
    - python test_plot.py GluGluToHToTauTau_histograms.root plot_higgs_output 1.0
  artifacts:
    paths:
    - plot_higgs_output
    expire_in: 1 week
    
# write another job to pull a test histogram file from EOS and perform a shape comparison?
    
    


